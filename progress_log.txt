## 2025년 11월 11일

### 기능: OOBB 충돌 감지 시스템 구현

- **목표:** `DirectX::BoundingOrientedBox`를 사용하여 객체 지향 경계 상자(OOBB) 충돌 감지 및 응답 시스템을 구현하여 플레이어가 다른 객체와 충돌할 때 겹치지 않도록 합니다.

- **주요 변경 사항:**
    1.  **`CGameObject` (`Object.h`, `Object.cpp`):**
        -   `DirectX::BoundingOrientedBox m_xmOOBB` 멤버를 추가하여 각 게임 객체의 경계 상자를 저장합니다.
        -   `XMFLOAT4X4 m_xmf4x4LastWorld` 멤버를 추가하여 충돌 시 위치를 복원하기 위해 이전 프레임의 월드 행렬을 저장합니다.
        -   `SetMesh` 함수가 호출될 때 메쉬의 정점 데이터를 기반으로 `m_xmOOBB`를 자동으로 생성하도록 `SetOOBB` 유틸리티 함수를 구현했습니다.
        -   `Animate` 메서드에서 객체의 변환이 업데이트되기 전에 `m_xmf4x4LastWorld`에 현재 월드 행렬을 저장하도록 수정했습니다.

    2.  **`CPlayer` (`Player.cpp`):**
        -   `Update` 메서드 시작 부분에서 플레이어의 `m_xmf4x4World`를 `m_xmf4x4LastWorld`에 복사하여, 이동 계산 전에 마지막 유효 위치를 기록하도록 했습니다.

    3.  **`CScene` (`Scene.h`, `Scene.cpp`):**
        -   장면의 모든 객체 간의 충돌을 처리하는 `CheckCollisions` 메서드를 새로 추가했습니다.
        -   이 메서드는 플레이어의 OOBB와 다른 모든 객체의 OOBB 간의 교차 여부를 확인합니다.
        -   충돌이 감지되면, 플레이어의 월드 행렬을 `m_xmf4x4LastWorld`로 되돌려 겹침을 방지합니다.
        -   매 프레임마다 충돌 검사를 수행하기 위해 `AnimateObjects` 메서드 끝에서 `CheckCollisions`를 호출하도록 수정했습니다.

    4.  **`CObjectsShader` (`Shader.h`):**
        -   `CScene`이 셰이더에 의해 관리되는 게임 객체 배열에 접근하여 충돌 검사를 수행할 수 있도록 `GetPpObjects()` 접근자 메서드를 추가했습니다.

- **결과:**
    - 이제 플레이어는 장면의 다른 객체와 충돌 시 통과하지 않고 정지합니다. 이는 기본적인 충돌 회피 동작을 제공하여 게임 월드의 상호작용을 개선합니다.
---
## 2025년 11월 9일

### 기능 변경: 배경 렌더링 SkyBox에서 ScreenQuadMesh로 전환

- **문제점:**
    - 사용자가 `SkyBox` 대신 이전 `ScreenQuadMesh`를 이용한 배경 렌더링을 요청.
- **해결:**
    - `Scene.h`: `CSkyBox* m_pSkyBox` 멤버 변수를 `CGameObject* m_pBackgroundObject`로 교체.
    - `Scene.cpp`:
        - `CScene::BuildObjects`: `m_pSkyBox` 생성 코드를 제거하고, `CScreenQuadMesh`를 사용하여 `m_pBackgroundObject`를 생성. `UI/Background.dds` 텍스처를 로드하여 `m_pBackgroundObject`에 할당.
        - `CScene::ReleaseObjects`: `m_pSkyBox` 해제 코드를 제거하고, `m_pBackgroundObject`를 해제.
        - `CScene::Render`: `MainMenu` 상태에서 `m_pSkyBox` 렌더링 코드를 제거하고, `m_pBackgroundObject`를 UI 버튼보다 먼저 렌더링하도록 수정.
        - `CScene::ReleaseShaderVariables` 및 `CScene::ReleaseUploadBuffers`: `m_pSkyBox` 관련 호출을 제거.
- **결과:**
    - 메인 메뉴 배경이 `SkyBox` 대신 `ScreenQuadMesh`를 사용하여 렌더링됨.
---
## 2025년 11월 12일

### 기능: 계층 구조 OBB 및 충돌 처리 구현

- **목표:** 계층 구조를 가진 복잡한 모델(예: 헬리콥터)에 대해 정확한 OBB(Oriented Bounding Box)를 계산하고, 이를 이용해 플레이어와의 충돌을 감지하고 처리하는 시스템을 구현합니다. 또한, 여러 개의 헬리콥터 객체를 지형 위에 동적으로 배치합니다.

- **주요 변경 사항:**
    1.  **`CMesh` (`Mesh.h`, `Mesh.cpp`):**
        -   메시의 로컬 공간 OBB를 저장하기 위해 `BoundingOrientedBox m_xmOOBB` 멤버를 추가했습니다.
        -   `CStandardMesh::LoadMeshFromFile` 함수에서 정점 데이터를 로드한 후, `BoundingOrientedBox::CreateFromPoints`를 호출하여 메시의 로컬 OBB를 자동으로 생성하도록 수정했습니다.
        -   `GetOOBB()` 접근자 메서드를 추가했습니다.

    2.  **`CGameObject` (`Object.h`, `Object.cpp`):**
        -   객체의 활성화 상태를 관리하기 위해 `bool m_bIsActive` 플래그와 관련 `IsActive()`, `SetActive()` 메서드를 추가했습니다.
        -   `Render` 함수 시작 부분에서 `m_bIsActive` 플래그를 확인하여, 비활성화된 객체는 렌더링되지 않도록 수정했습니다.
        -   계층 구조 전체의 월드 공간 OBB를 계산하는 `UpdateBoundingBox()` 메서드를 새로 구현했습니다. 이 메서드는 재귀적으로 자식 객체의 OBB를 변환하고 병합하여 최종 OBB를 계산합니다.
        -   `Animate` 메서드에서 `UpdateTransform()` 호출 후 `UpdateBoundingBox()`를 호출하여 매 프레임마다 OBB가 갱신되도록 수정했습니다.
        -   기존의 부정확한 `SetOOBB` 함수를 제거하고 `GetOOBB`가 월드 공간 OBB를 반환하도록 수정했습니다.

    3.  **`CScene` (`Scene.h`, `Scene.cpp`):**
        -   게임 객체 관리를 유연하게 하기 위해 기존의 C-스타일 배열(`CGameObject**`)을 `std::vector<CGameObject*>`로 변경했습니다.
        -   `BuildObjects` 함수에서 15개의 `CMi24Object` (헬리콥터)를 생성했습니다. 각 헬리콥터는 지형(`CHeightMapTerrain`)의 너비와 길이를 기반으로 무작위 (x, z) 위치에 배치되며, `GetHeight()`를 통해 얻은 지형 높이에 맞춰 y 좌표가 설정됩니다.
        -   `CheckCollisions` 메서드를 수정하여 플레이어와 `m_vGameObjects`에 포함된 모든 활성 헬리콥터 간의 충돌을 검사하도록 했습니다.
        -   충돌이 감지되면, 해당 헬리콥터는 `SetActive(false)`를 통해 비활성화되고, 플레이어는 충돌 전 위치(`m_xmf4x4LastWorld`)로 되돌아갑니다.
        -   `AnimateObjects`, `Render`, `ReleaseObjects` 함수를 `std::vector`를 사용하도록 모두 업데이트했습니다.

- **결과:**
    - 이제 게임 월드에 여러 대의 헬리콥터가 지형에 맞춰 동적으로 배치됩니다.
    - 플레이어가 헬리콥터와 충돌하면 해당 헬리콥터는 화면에서 사라지며(비활성화), 플레이어는 더 이상 진행할 수 없습니다.
    - 계층 구조를 가진 객체에 대해서도 정확한 OBB가 계산되어 정밀한 충돌 감지가 가능해졌습니다.
---
## 2025년 11월 12일 (오류 수정 및 객체 관리 리팩토링)

### 문제점: 컴파일 오류 및 헬리콥터 객체 미표시

- **컴파일 오류:**
    - `'CreateMerged': 'DirectX::BoundingOrientedBox'의 멤버가 아닙니다.`
    - `'m_nGameObjects': 선언되지 않은 식별자입니다.`
    - `'m_ppGameObjects': 선언되지 않은 식별자입니다.`
    - `'SetOOBB': 식별자를 찾을 수 없습니다.`
- **헬리콥터 객체 미표시:**
    - 이전에 `CScene`에서 직접 생성한 헬리콥터 객체들이 렌더링되지 않음. `CObjectsShader`가 객체 렌더링을 담당하고 있었으나, `CScene`의 객체 목록과 `CObjectsShader`의 객체 목록이 분리되어 있었기 때문.

### 해결 및 주요 변경 사항:

1.  **OBB 병합 로직 수정 (`Object.cpp` - `CGameObject::UpdateBoundingBox`)**:
    *   `DirectX::BoundingOrientedBox::CreateMerged` 함수가 존재하지 않아 발생한 오류를 수정했습니다.
    *   `UpdateBoundingBox` 함수를 재귀적이지 않게 변경하고, 현재 객체의 모든 메시와 활성화된 자식 객체들의 월드 공간 OBB 코너 점들을 수집한 후, `DirectX::BoundingOrientedBox::CreateFromPoints`를 사용하여 이 모든 점들을 포함하는 새로운 OBB를 생성하도록 로직을 개선했습니다.

2.  **계층적 OBB 업데이트 순서 조정 (`Object.cpp` - `CGameObject::Animate`)**:
    *   `CGameObject::Animate` 함수 내에서 `UpdateTransform()` 호출 후 `UpdateBoundingBox()`를 호출하던 순서를, 자식 객체들의 `Animate` 호출이 완료된 후 부모 객체의 `UpdateBoundingBox()`를 호출하는 후위 순회(post-order traversal) 방식으로 변경했습니다. 이는 계층 구조에서 자식 객체의 OBB가 먼저 계산된 후 부모 OBB에 병합될 수 있도록 하여 OBB 계산의 정확성을 높입니다.

3.  **`SetOOBB` 호출 제거 (`Object.cpp` - `CGameObject::SetMesh`)**:
    *   `Object.h`에서 `SetOOBB` 함수를 제거했음에도 `CGameObject::SetMesh`에서 해당 함수를 호출하던 부분을 제거하여 컴파일 오류를 해결했습니다. OBB 초기화는 이제 메시 로드 시 `CMesh`에서, 그리고 계층적 업데이트는 `CGameObject::Animate`에서 처리됩니다.

4.  **객체 관리 리팩토링 및 헬리콥터 표시 문제 해결**:
    *   **`Scene.h` 원복**: `CScene`의 게임 객체 관리 방식을 `std::vector<CGameObject*>`에서 원래의 `CGameObject** m_ppGameObjects` 및 `int m_nGameObjects` 배열 방식으로 되돌렸습니다.
    *   **`Shader.cpp` (`CObjectsShader::BuildObjects`) 수정**:
        *   `pContext` 인자로 `CHeightMapTerrain` 객체를 받아, 헬리콥터 객체들을 생성할 때 지형의 너비와 길이를 기반으로 무작위 (x, z) 위치를 생성하고 `GetHeight()`를 통해 얻은 지형 높이에 맞춰 y 좌표를 설정하도록 변경했습니다.
        *   기존의 하드코딩된 구체 배치 로직을 대체했습니다.
    *   **`Scene.cpp` (`CScene::BuildObjects`) 수정**:
        *   `CHeightMapTerrain` 객체를 `CObjectsShader::BuildObjects` 호출 전에 생성하도록 순서를 조정했습니다.
        *   `CObjectsShader::BuildObjects` 호출 시 `m_pTerrain`을 `pContext`로 전달했습니다.
        *   `CScene`의 `m_ppGameObjects`와 `m_nGameObjects`가 `CObjectsShader`의 내부 객체 목록을 참조하도록 연결했습니다 (`pObjectsShader->GetPpObjects()`, `pObjectsShader->GetNumberOfObjects()`).
    *   **`Scene.cpp` 함수들 원복 및 수정**:
        *   `CScene::ReleaseObjects`: `m_ppGameObjects`를 직접 해제하는 루프를 제거했습니다. 객체 소유권은 `CObjectsShader`에 있습니다.
        *   `CScene::AnimateObjects`: `m_ppGameObjects`를 순회하며 각 객체의 `Animate` 함수를 호출하도록 되돌렸습니다.
        *   `CScene::Render`: `m_ppGameObjects`를 직접 렌더링하는 루프를 제거하고, `CObjectsShader`의 `Render` 함수가 객체 렌더링을 담당하도록 했습니다.
        *   `CScene::ReleaseUploadBuffers`: `m_ppGameObjects`의 업로드 버퍼를 직접 해제하는 루프를 제거하고, `CObjectsShader`의 `ReleaseUploadBuffers` 함수가 이를 처리하도록 했습니다.
        *   `CScene::CheckCollisions`: `m_ppGameObjects`를 순회하며 플레이어와의 충돌을 검사하도록 수정했습니다.

- **결과:**
    - 모든 컴파일 오류가 해결되었습니다.
    - 헬리콥터 객체들이 지형 표면에 정상적으로 배치되고 렌더링됩니다.
    - 플레이어와 헬리콥터 간의 OBB 충돌 감지 및 반응 로직이 의도한 대로 작동합니다.
    - 객체 관리 방식이 기존 아키텍처에 맞춰 리팩토링되어 코드의 일관성과 유지보수성이 향상되었습니다.