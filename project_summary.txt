## 프로젝트 요약: 시작 화면 구현 완료

### 목표
3DGP-2 프로젝트에서 시작 및 종료 UI 버튼, 호버 효과, 피킹 기능 및 배경 렌더링을 포함한 메인 메뉴 시작 화면을 구현합니다.

### 구현된 기능

1.  **UI 버튼 (`CUIRectMesh`)**:
    *   정규화된 화면 좌표(x, y, 너비, 높이)를 기반으로 UI 요소를 정의하는 `CUIRectMesh` 클래스를 구현했습니다.
    *   시작 및 종료 버튼은 `CUIRectMesh` 객체로 생성되었으며, 1:1 종횡비를 유지하도록 크기가 조정되었습니다.

2.  **UI 셰이더 (`CUIShader`)**:
    *   UI 렌더링을 위한 `CUIShader`를 구현했습니다.
    *   알파 블렌딩을 활성화하고 컬링을 비활성화하여 UI 요소의 올바른 렌더링을 보장했습니다.
    *   `Shaders.hlsl`에 정의된 `VS_UI` 및 `PS_UI` 진입점을 사용하도록 셰이더 컴파일을 수정했습니다.

3.  **호버 효과**:
    *   마우스가 버튼 위로 이동할 때 버튼 텍스처가 변경되는 호버 효과를 구현했습니다.
    *   `CScene`에 기본 및 호버 텍스처를 추적하는 멤버 변수와 현재 호버된 UI 객체를 추적하는 `m_pHoveredObject`를 추가했습니다.
    *   `CScene::UpdateUIButtons` 함수는 `m_pHoveredObject` 상태에 따라 버튼 텍스처를 전환합니다.
    *   `GameFramework::OnProcessingMouseMessage`에서 마우스 이동 메시지를 처리하여 마우스 좌표를 NDC로 변환하고 `CScene::PickObjectByRayIntersection`을 호출하여 `m_pHoveredObject`를 업데이트합니다.

4.  **피킹 기능**:
    *   마우스 클릭 또는 호버 좌표(NDC)가 버튼의 NDC 경계 내에 있는지 확인하여 UI 버튼에 대한 피킹 기능을 구현했습니다.
    *   `CScene::PickObjectByRayIntersection` 함수는 마우스 아래의 `CGameObject`를 식별합니다.
    *   `WM_LBUTTONDOWN` 메시지 처리 시, "시작" 버튼 클릭 시 게임 상태를 `MainMenu`에서 `InGame`으로 전환하고, "종료" 버튼 클릭 시 애플리케이션을 종료합니다.

5.  **배경 렌더링**:
    *   메인 메뉴 상태에서 UI 요소 뒤에 배경을 렌더링하도록 구현했습니다.
    *   초기 `SkyBox` 구현에서 `ScreenQuadMesh`를 사용한 배경 렌더링으로 전환했습니다. `UI/Background.dds` 텍스처를 사용하여 전체 화면 쿼드를 렌더링합니다.

### 주요 수정 및 버그 해결

*   **`CMaterial::GetTexture()` 멤버 누락**: `CMaterial` 클래스에 `GetTexture()` 메서드를 추가하여 컴파일 오류를 해결했습니다.
*   **`CTexture` 객체 수명 관리**: `CScene::BuildObjects`에서 `CTexture` 객체를 멤버 변수로 직접 생성하여 잠재적인 매달린 포인터 및 잘못된 참조 카운팅 문제를 해결했습니다.
*   **잘못된 GPU 디스크립터 핸들**: `CScene::CreateShaderResourceView`에서 `pTexture->SetGpuDescriptorHandle` 호출 순서를 수정하여 `CTexture` 객체가 올바른 GPU 디스크립터 핸들을 저장하도록 했습니다.
*   **셰이더 파일 및 진입점 불일치**: `CUIShader`가 `UIShader.hlsl` 대신 `Shaders.hlsl`의 `VS_UI` 및 `PS_UI` 진입점을 사용하도록 수정했습니다.
*   **피킹 로직의 부동 소수점 부정확성**: `CScene::PickObjectByRayIntersection`의 `IsPointInBox` 람다에 작은 엡실론을 추가하여 부동 소수점 비교의 견고성을 높였습니다.

---

### 기능: 계층 구조 OBB 및 충돌 처리 구현 완료 (오류 수정 및 객체 관리 리팩토링 포함)

#### 목표
계층 구조를 가진 복잡한 모델(예: 헬리콥터)에 대해 정확한 OBB(Oriented Bounding Box)를 계산하고, 이를 이용해 플레이어와의 충돌을 감지하고 처리하는 시스템을 구현했습니다. 또한, 여러 개의 헬리콥터 객체를 지형 위에 동적으로 배치했습니다.

#### 구현된 기능

1.  **계층 구조 OBB (Hierarchical OBB) 구현**:
    *   **`CMesh`**: 로컬 공간 OBB(`m_xmOOBB`)를 추가하고, 메시 로드 시 정점 데이터로부터 자동으로 OBB를 생성하도록 구현했습니다.
    *   **`CGameObject`**: 객체 및 모든 자식 객체를 포함하는 월드 공간 OBB를 계산하는 재귀적이지 않은 `UpdateBoundingBox()` 메서드를 구현했습니다. 이 메서드는 모든 메시와 활성화된 자식 객체들의 월드 공간 OBB 코너 점들을 수집한 후, `DirectX::BoundingOrientedBox::CreateFromPoints`를 사용하여 새로운 OBB를 생성합니다.
    *   **`Animate` 루프**: `CGameObject::Animate` 함수 내에서 `UpdateTransform()` 호출 후 `UpdateBoundingBox()`를 호출하던 순서를, 자식 객체들의 `Animate` 호출이 완료된 후 부모 객체의 `UpdateBoundingBox()`를 호출하는 후위 순회(post-order traversal) 방식으로 변경하여 OBB 계산의 정확성을 높였습니다.

2.  **동적 객체 생성 및 관리**:
    *   **`CScene` 객체 관리 리팩토링**: 게임 객체 관리 방식을 `std::vector<CGameObject*>`에서 원래의 `CGameObject** m_ppGameObjects` 및 `int m_nGameObjects` 배열 방식으로 되돌렸습니다. 이는 `CObjectsShader`가 객체들을 소유하고 관리하는 기존 아키텍처에 맞추기 위함입니다.
    *   **`CObjectsShader::BuildObjects` 수정**: `pContext` 인자로 `CHeightMapTerrain` 객체를 받아, 헬리콥터 객체들을 생성할 때 지형의 너비와 길이를 기반으로 무작위 (x, z) 위치를 생성하고 `GetHeight()`를 통해 얻은 지형 높이에 맞춰 y 좌표를 설정하도록 변경했습니다.
    *   **`CScene::BuildObjects` 수정**: `CHeightMapTerrain` 객체를 `CObjectsShader::BuildObjects` 호출 전에 생성하도록 순서를 조정하고, `m_pTerrain`을 `pContext`로 전달했습니다. 또한, `CScene`의 `m_ppGameObjects`와 `m_nGameObjects`가 `CObjectsShader`의 내부 객체 목록을 참조하도록 연결했습니다.

3.  **충돌 감지 및 처리**:
    *   **`CGameObject`**: 객체의 활성화 상태를 제어하는 `m_bIsActive` 플래그를 추가하여, 비활성화된 객체는 렌더링되지 않도록 최적화했습니다.
    *   **`CScene::CheckCollisions`**: `m_ppGameObjects` (CObjectsShader가 관리하는 객체들)를 순회하며 플레이어와 모든 활성 헬리콥터 객체 간의 OBB 교차 검사를 수행하도록 로직을 수정했습니다.
    *   **충돌 반응**: 플레이어와 헬리콥터가 충돌하면, 해당 헬리콥터는 비활성화(`SetActive(false)`)되어 화면에서 사라지고, 플레이어는 충돌 전 마지막 위치로 이동합니다.

#### 주요 수정 및 버그 해결

*   **`CreateMerged` 오류 해결**: `DirectX::BoundingOrientedBox::CreateMerged` 대신 `DirectX::BoundingOrientedBox::CreateFromPoints`를 사용하여 OBB 병합 로직을 수정했습니다.
*   **`m_nGameObjects`, `m_ppGameObjects` 오류 해결**: `CScene`의 객체 관리 방식을 `std::vector`에서 배열로 되돌리고, 관련 함수들(`ReleaseObjects`, `AnimateObjects`, `Render`, `ReleaseUploadBuffers`, `CheckCollisions`)에서 `m_ppGameObjects`와 `m_nGameObjects`를 올바르게 사용하도록 수정했습니다.
*   **`SetOOBB` 오류 해결**: `CGameObject::SetMesh`에서 존재하지 않는 `SetOOBB` 함수 호출을 제거했습니다.
*   **헬리콥터 객체 미표시 문제 해결**: `CObjectsShader`가 객체를 생성하고 관리하는 기존 아키텍처를 활용하여, `CScene`에서 셰이더의 객체 목록을 참조하고 지형에 맞춰 위치를 재설정함으로써 헬리콥터가 정상적으로 렌더링되도록 했습니다.

#### 다음 단계
사용자는 프로젝트를 컴파일하고 애플리케이션을 실행하여 지형에 흩뿌려진 헬리콥터들과 플레이어 간의 충돌 기능을 테스트해야 합니다. 충돌 시 헬리콥터가 사라지고 플레이어가 뒤로 밀리는지 확인합니다.
