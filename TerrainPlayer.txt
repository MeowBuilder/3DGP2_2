TerrainPlayer가 Terrain과 상호작용하는 메커니즘 요약:

1.  **지형 데이터 소스:**
    *   지형 높이 정보는 `Image/HeightMap.raw`와 같은 원시 높이 맵 파일에 저장됩니다.
    *   이 파일은 `CHeightMapImage` 객체로 로드되며, 이 객체는 지형의 스케일(`m_xmf3Scale`)도 함께 관리합니다.

2.  **플레이어 초기화:**
    *   `CTerrainPlayer`는 `CHeightMapTerrain` 객체(실제로는 `pContext`로 전달된 `CHeightMapImage` 객체)에 대한 포인터로 초기화됩니다.

3.  **플레이어 높이 조정 (`CTerrainPlayer::OnPlayerUpdateCallback`):**
    *   매 업데이트 프레임마다 플레이어의 현재 월드 XZ 좌표가 사용됩니다.
    *   이 월드 좌표는 지형의 X 및 Z 스케일로 나누어 높이 맵 이미지 좌표로 변환됩니다.
    *   `CHeightMapImage::GetHeight` 메서드가 이 좌표와 함께 호출됩니다. 이 메서드는 원시 높이 맵 데이터에 대해 이중 선형 보간을 수행하여 플레이어의 정확한 XZ 위치에서 지형 높이를 정확하게 결정합니다.
    *   보간된 지형 높이에 고정 오프셋(6.0f)이 추가되어 플레이어의 원하는 Y-위치가 결정됩니다.
    *   만약 플레이어의 현재 Y-위치가 이 원하는 높이보다 낮으면, 플레이어의 수직 속도(`y` velocity)는 0으로 설정되고, Y-위치는 원하는 높이로 스냅됩니다. 이는 플레이어가 지형을 통과하는 것을 방지하고 지형 표면 위를 걷는 것을 시뮬레이션합니다.

4.  **카메라 높이 조정 (`CTerrainPlayer::OnCameraUpdateCallback`):**
    *   플레이어와 유사하게 카메라의 높이도 지형 위에 있도록 조정됩니다.
    *   `CHeightMapImage::GetHeight`를 사용하여 카메라의 XZ 좌표에서 지형 높이를 얻고, 플레이어와는 약간 다른 오프셋(5.0f)을 추가합니다.
    *   카메라의 Y-위치가 계산된 높이보다 낮거나 같으면, 카메라의 Y-위치는 해당 높이로 조정됩니다. 이는 카메라가 지형을 통과하지 않도록 합니다.
    *   `THIRD_PERSON_CAMERA` 모드에서는 카메라가 플레이어를 바라보도록 `SetLookAt` 함수가 호출됩니다.

5.  **중력과의 상호작용:**
    *   플레이어에게는 중력이 적용되어 자연스럽게 아래로 떨어지게 됩니다.
    *   그러나 `OnPlayerUpdateCallback`은 플레이어가 지면에 있을 때 플레이어의 높이를 지형에 지속적으로 조정함으로써 중력에 효과적으로 대응하는 "바닥" 역할을 합니다.

이러한 메커니즘을 통해 플레이어(및 카메라)는 동적으로 계산된 지형 표면 위에서 항상 고정된 높이를 유지하며, 지형 위를 걷는 듯한 사실적인 경험을 제공합니다.
